#### 1. Introduction and Overview
- **Purpose**: This document outlines the design for Scratch Wallet, a mobile (iOS/Android) and Linux application enabling secure, person-to-person payments without relying exclusively on the internet. It uses mesh networking and its own blockchain to facilitate transactions, solving the problem of making payments in areas with limited or no internet connectivity, much like cash exchanges but in digital form.
- **Project Description**: Scratch Wallet allows users to send and receive payments using a custom cryptocurrency called "Scratch." The system operates in a closed-loop manner, meaning transactions primarily occur within the Scratch ecosystem. Additionally, users can opt to buy Bitcoin (BTC) as a savings pot, providing a bridge to external cryptocurrencies for long-term value storage.
- **Goals and Objectives**:
  - Enable offline-capable payments via mesh networks for everyday transactions.
  - Mimic the anonymity and simplicity of cash while ensuring strong privacy and security.
  - Promote fast adoption by leveraging common mobile devices, with Linux support for tech-savvy users or fixed-point scenarios (e.g., shop terminals).
  - Provide basic financial tools like balance checks and history for users such as small shopkeepers.
  - Boost user growth through a referral program rewarding 50 Scratch to both the referrer and new user to encourage adoption while maintaining economic stability and a visually trustworthy interface with green and dark grey colors to convey safe, secure finances.
  - Establish a sustainable closed-loop economy with a 21 billion Scratch maximum supply, using a gradual release minting strategy to control distribution of signup bonuses and referral rewards (50 Scratch per person, halving every 4 years), ensuring long-term value stability.
  - Enhance transaction usability by allowing users to add a private purpose note (e.g., “labour,” “bananas”) visible only to the payer and payee, maintaining cash-like anonymity while providing context for payments.
- **Scope**:
  - In Scope: Mobile (iOS/Android) and Linux platforms; sending/receiving Scratch payments with private purpose notes (e.g., “Item A”), balance checking, payment history, privacy features (encryption and anonymity), mesh networking for connectivity, own blockchain for transaction validation, BTC savings pot, 100 Scratch signup bonus, referral code system with 50 Scratch rewards per person (halving every 4 years), 21 billion Scratch supply cap with gradual release minting, and green/dark grey UI to promote trust and security.
  - Out of Scope: Full integration with other cryptocurrencies beyond BTC purchases, advanced trading features, or support for large-scale enterprise use. No initial focus on regulatory compliance (e.g., KYC), as it prioritizes cash-like anonymity.
- **Intended Audience**: Everyday people for personal payments and small shopkeepers for business transactions on mobile devices; tech-savvy users or fixed-point shopkeepers (e.g., using Linux PCs or devices like Raspberry Pi) for the Linux version. This SDD is for potential developers, collaborators, or yourself to guide implementation.
- **Background**: Inspired by technologies like Briar for mesh networking and Meshtastic for low-cost radio nodes, but adapted for mobile phones and Linux devices to ensure broader accessibility. The app emphasizes security, potentially drawing from dedicated hardware principles, while being user-friendly for non-technical users.

#### 2. System Architecture
- **High-Level Components**:
  - **Mobile App Frontend**: User interface for iOS/Android devices for interactions like sending payments or viewing history.
  - **Linux App Frontend**: User interface for Linux desktops or devices (e.g., Ubuntu, Debian, or Raspberry Pi), supporting similar functionality (payments, history, referrals).
  - **Mesh Networking Layer**: Handles device-to-device communication, prioritizing Bluetooth for short-range, direct connections (e.g., in proximity scenarios like User1 and User2 exchanging payments), with fallback to other protocols (e.g., Wi-Fi Direct or radio-based if supported) for extended hops.
  - **Blockchain Backend**: A custom, lightweight blockchain for validating and recording Scratch transactions in a decentralized manner.
  - **Wallet Module**: Manages user balances, keys, and the BTC savings integration across platforms.
  - **External Integration**: A secure gateway for purchasing BTC (e.g., via occasional internet connection to an exchange API).
- **How Components Connect**: Mobile and Linux devices form ad-hoc mesh networks, primarily using Bluetooth for direct, proximity-based transactions (e.g., User1 and User2 exchanging 1 Scratch for “Item A”). Transactions are encrypted and broadcast via Bluetooth to nearby devices (mobile or Linux), syncing with the blockchain when nodes connect. Linux devices may act as fixed nodes (e.g., shop terminals) or mobile nodes (e.g., laptops). For BTC purchases, the app connects to the internet opportunistically.
- **Key Decisions**: Use a mobile-first approach for uptake, with Linux as a secondary platform, leveraging cross-platform frameworks (e.g., Qt or Electron) for UI consistency. Prioritize Bluetooth for its ubiquity in mobile and Linux devices, low energy use, and suitability for short-range (e.g., 10-100 meters) peer-to-peer payments, ensuring compatibility with offline scenarios. Fallback to other mesh protocols (e.g., Wi-Fi Direct) for broader network coverage. The blockchain should be energy-efficient for mobile devices and compatible with Linux.
- **Assumptions**: Users have compatible smartphones or Linux devices; mesh range is limited (e.g., 100-500 meters per hop), requiring proximity or chains of devices for longer distances. Linux users (e.g., shopkeepers with PCs or tech-savvy individuals) have Bluetooth-capable hardware for mesh networking.

#### 3. Data Design
- **Types of Data**:
  - Transaction data: Sender/receiver addresses (anonymous hashes), amount in Scratch, timestamps, and an encrypted purpose field (e.g., “labour,” “bananas”) accessible only to payer and payee.
  - User data: Local wallet balance, payment history, encrypted private keys.
  - BTC savings: Linked BTC balance and transaction records.
  - Referral data: Unique referral codes tied to user wallets (anonymized), records of successful referrals, and associated Scratch rewards.
  - Signup bonus data: Record of 100 Scratch credited to new users, tied to their anonymous wallet address.
- **Data Flow**: User initiates payment → Enters Scratch amount and optional purpose note (e.g., “bananas”) → App encrypts transaction (including purpose) → Broadcast via mesh → Recipient verifies and decrypts (sees amount and purpose) → Blockchain appends record when synced. For BTC: User requests purchase → App uses internet (if available) to buy and store BTC in a segregated pot. New user installs app → Completes setup (creates wallet) → System credits 100 Scratch to wallet → Records transaction in blockchain. Existing user generates referral code → Shares code → New user enters code during signup → System verifies code → Mints Scratch (50 Scratch each, halving every 4 years) → Credits wallets → Records in blockchain.
- **Storage Details**: Local storage on device for wallet data (encrypted); distributed blockchain across participating nodes for transaction ledger. Use secure standards like AES for encryption.
- **Data Rules**: Transactions are only transparent between payer and payee; no global visibility. Anonymity ensured by not linking to real identities. Closed-loop for Scratch means it can't be directly exchanged outside without conversion (e.g., via BTC feature). Total Scratch supply capped at 21 billion, released gradually via a predefined schedule (e.g., X Scratch per year or tied to network growth) to fund signup bonuses (100 Scratch per new user) and referral rewards (50 Scratch per person, halving every 4 years). Referral codes are anonymous, tied only to wallet addresses, not identities, to maintain privacy. Limit referrals to prevent abuse (e.g., max 10 referrals per user or time-based caps). Purpose field is optional, text-based (e.g., max 50 characters), and encrypted using end-to-end encryption (e.g., AES-256) to ensure only payer and payee can view it. Blockchain stores the encrypted purpose field as part of the transaction record, ensuring no third party (even other nodes) can access it. Minting records stored in the blockchain, specifying amount, recipient (anonymous wallet address), and purpose (signup or referral). Anti-fraud rules: Limit referrals (e.g., 5-10 per user); ensure one-time signup bonus per device; enforce gradual release to prevent supply spikes.

#### 4. Interface Design
- **Internal Interfaces**: App modules communicate via local APIs (e.g., wallet calls blockchain for validation).
- **External Interfaces**: 
  - Mesh protocol for device peering (prioritizing Bluetooth, similar to Briar or Meshtastic).
  - BTC purchase API (e.g., integrate with a service like Coinbase or a decentralized exchange for buying BTC).
- **Data Formats**: JSON for transaction payloads; cryptographic hashes for anonymity.
- **Error Handling**: If mesh connection fails, queue transactions for later sync. Friendly messages like "Transaction pending – move closer to network."
- **Security**: End-to-end encryption; no identity requirements; hardware-inspired security (e.g., secure enclave on phones, equivalent on Linux).

#### 5. Component Design
- **Wallet Component**:
  - Purpose: Core user management, including signup bonus allocation and referral rewards.
  - Inputs/Outputs: Input – New user registration or referral code entry; Output – Wallet initialized with 100 Scratch, or Scratch credited to referrer and new user.
  - Logic: During setup, verify unique installation, mint 100 Scratch (or draw from gradual release pool), credit to user’s wallet, and log to blockchain. Initialize new wallets with 100 Scratch signup bonus, drawn from the gradual release pool; credit referral rewards (50 Scratch initially, halving every 4 years); verify minting requests against release schedule to ensure compliance with 21 billion cap.
- **Payment Module**:
  - Purpose: Handle sending/receiving payments with private purpose notes.
  - Inputs/Outputs: Input – Amount, recipient, optional purpose note (e.g., “labour”); Output – Encrypted transaction with confirmation.
  - Logic: Collect payment details and purpose note; encrypt note with recipient’s public key and sender’s private key; broadcast via Bluetooth for direct transfers or mesh for relayed transfers; recipient decrypts to view amount and purpose; log encrypted transaction to blockchain.
- **History and Balance Module**:
  - Purpose: Track and display records.
  - Inputs/Outputs: Input – Query; Output – List of transactions/balance.
  - Logic: Pull from local storage and sync with blockchain.
- **Privacy Module**:
  - Purpose: Ensure anonymity and security for all transaction data, including purpose notes.
  - Logic: Apply end-to-end encryption to purpose fields; use zero-knowledge proofs or similar for verification without exposing note contents; ensure only payer and payee can decrypt.
- **BTC Savings Module**:
  - Purpose: Allow buying BTC as a savings pot.
  - Inputs/Outputs: Input – Amount in Scratch/USD; Output – BTC balance.
  - Logic: Convert Scratch (if applicable) or use fiat gateway; store BTC separately for security.
- **Blockchain Component**:
  - Purpose: Validate transactions and manage Scratch supply with gradual release.
  - Logic: Enforce 21 billion Scratch cap; implement gradual release minting (e.g., release Y Scratch annually, adjusted for signup/referral demand or network size); track referral rewards (50 Scratch per person, halving every 4 years via timestamp-based rules); log minting events as special transactions (e.g., “signup credit” or “referral credit”); store transactions with encrypted purpose fields; ensure purpose data is inaccessible to non-involved parties; use lightweight consensus suitable for mobile and Linux mesh networks.
- **Mesh Networking Component**:
  - Purpose: Enable offline connectivity for transaction propagation across mobile and Linux devices.
  - Inputs/Outputs: Input – Encrypted transaction packets (including amount and purpose note); Output – Relayed to peers or recipient.
  - Logic: Form dynamic mesh networks, prioritizing Bluetooth for direct device connections in proximity (e.g., User1 to User2 for 1 Scratch payment); route transactions hop-by-hop to other Scratch Wallet nodes for blockchain syncing; optimize for low power on mobiles and compatibility on Linux.
- **Referral Module**:
  - Purpose: Handle referral code generation, validation, and reward distribution with halving mechanism.
  - Inputs/Outputs: Input – Code generation request or code entry; Output – 50 Scratch credited to both referrer and new user (halving to 25 Scratch in 4 years, 12.5 Scratch in 8 years, etc.).
  - Logic: Generate secure, anonymous referral codes; validate code on signup; check current halving period (based on blockchain timestamp); request 50 Scratch per person (halving every 4 years) from the gradual release pool; update wallets and log to blockchain.
- **Linux App Frontend**:
  - Purpose: Provide user interface for Linux users to perform payments, view history, and manage referrals/BTC savings.
  - Inputs/Outputs: Input – User actions (e.g., send 1 Scratch, enter purpose note); Output – UI updates (e.g., transaction confirmation).
  - Logic: Mirror mobile UI functionality with green/dark grey theme; adapt to Linux desktop environments (e.g., GNOME, KDE) using cross-platform toolkit; integrate with Bluetooth and blockchain modules.

#### 6. User Interface Design
- **Layout Descriptions**: Simple, intuitive screens for mobile and Linux – Home: Balance overview; Send/Receive: QR code scanner for payments; History: Scrollable list; Savings: BTC pot view with buy option. Referral screen: Displays user’s unique referral code (text/QR code) in green text on a dark grey background; “Share” button in green; input field for new users to enter codes with a secure, trust-evoking design.
- **User Flows**: Open app → Check balance → Scan QR to send Scratch → Confirm (encrypted) → View in history. For BTC: Navigate to savings → Enter amount → Buy (internet required) → View BTC balance. Existing user: Navigate to referral section → View/share code → Receive notification when Scratch is credited after successful referral. New user: During signup, see option to enter referral code → Input code → Receive confirmation of extra Scratch (e.g., “You got 50 extra Scratch for using a referral!”).
- **Visual Elements**: Green (#2E7D32) and dark grey (#212121) color scheme to convey safety, security, and professionalism, inspired by trusted financial apps. Accent colors (e.g., white or subtle gold) for buttons and highlights to maintain clarity. Example: Home screen with a dark grey background, green buttons for “Send Scratch” and “Receive Scratch,” and white text for balances to ensure readability. Clean design mimicking a physical wallet; use icons for actions; support dark mode. Purpose field styled in green with placeholder text (e.g., “Purpose: e.g., groceries”); lock icon next to field to signal encryption, reinforcing trust. Referral screen: Green card at top showing user’s referral code and a scannable QR code; green “Share Code” button; below, an input field for new users to enter a referral code, styled in green with a subtle dark grey border. Feedback: On successful referral, a green notification says, “You earned 50 Scratch for inviting a friend!” with a note about halving (e.g., “Rewards halve every 4 years, next in 2029”). Send: Dark grey background; green input field for Scratch amount; new text field below for purpose note (e.g., “Enter purpose: bananas”); green QR code scanner button; green “Confirm” button. Receive: Displays user’s QR code and wallet address; on receiving payment, shows amount and purpose note (e.g., “Received 20 Scratch for bananas”) in a green notification, visible only to recipient. History: List of transactions now includes purpose notes (e.g., “Sent 20 Scratch for bananas, 10/25/25”) in green text, visible only to the user (payer or payee); dark grey panel with white dates for contrast. Visual Cue: Small green calendar icon near referral section to signal halving schedule, ensuring transparency. Linux UI: Same green/dark grey theme, adapted for Linux desktops (e.g., larger windows, mouse-based navigation). Home screen shows balance (e.g., “150 Scratch”) on a green card, with green buttons for “Send Scratch,” “Receive Scratch,” and tabs for History, Referrals, and BTC Savings. Send screen includes input for amount and purpose note; History shows transactions (e.g., “Received 1 Scratch for Item A”).
- **Accessibility**: Voice-over support; large buttons for shopkeepers; high contrast (green on dark grey meets WCAG 2.1); support screen readers on mobile and Linux (e.g., Orca for Linux). Linux UI optimized for desktop (e.g., resizable windows, keyboard shortcuts).

#### 7. Assumptions and Dependencies
- **Assumptions**: Users are in proximity for mesh to work effectively; occasional internet for BTC purchases and initial setup. Regulatory aspects (e.g., crypto laws) will be handled post-design. A 50 Scratch referral reward (100 Scratch total per referral: 50 for referrer, 50 for new user) supports sustainable growth in the closed-loop Scratch economy, assuming controlled minting or a capped supply. Gradual release of Scratch (e.g., fixed annual release or dynamic based on user growth) supports economic stability within the 21 billion cap, funding 100 Scratch signup bonuses and 50 Scratch referral rewards (halving every 4 years) without early oversupply. Users understand halving through clear UI messaging (e.g., “Referral rewards halve in 2029!”). Bluetooth is the primary mesh networking protocol for short-range, direct transactions (e.g., users standing next to each other), offering sufficient range (10-100 meters) and compatibility with most smartphones and Linux devices; extended hops may use other protocols if Bluetooth range is insufficient. Users are often in proximity for direct payments, as in the example of User1 and User2 exchanging 1 Scratch for “Item A,” with blockchain syncing occurring opportunistically via nearby Scratch Wallet nodes. Users will use the purpose field for clarity (e.g., “labour,” “bananas”); encryption ensures privacy, maintaining cash-like anonymity even with added context. Linux users (e.g., shopkeepers with PCs or tech-savvy individuals) have Bluetooth-capable hardware for mesh networking, supporting direct transactions. Blockchain syncing via Bluetooth works similarly on Linux and mobile, with each wallet maintaining a local blockchain version.
- **Dependencies**: Mobile OS APIs for Bluetooth Low Energy (BLE) and Linux-compatible Bluetooth libraries (e.g., BlueZ) for efficient, short-range communication; external BTC exchange service; open-source libraries for blockchain/mesh (e.g., inspired by Hyperledger or Briar protocols). Blockchain with a minting schedule (e.g., smart contract or predefined rules) to enforce gradual release, tied to network metrics (e.g., user count) or time (e.g., 1 billion Scratch/year for 21 years). Reliable timestamp mechanism for halving and release tracking. Robust encryption library (e.g., OpenSSL for AES-256) for securing purpose notes in transactions. Blockchain capable of storing encrypted metadata (purpose field) without compromising performance on mobile or Linux mesh networks. Cross-platform UI framework (e.g., Qt, GTK, or Electron) for consistent green/dark grey design on Linux.
- **Constraints**: No coding experience means focus on no/low-code tools if possible (e.g., Bubble.io for prototyping); prioritize security to avoid breaches; closed-loop limits interoperability. Referral rewards of 50 Scratch per person require strict anti-fraud measures (e.g., unique device verification, referral limits like 5-10 per user) to prevent abuse and maintain economic stability. Gradual release requires careful design to balance signup/referral demand with supply limits; developers must define release parameters (e.g., 5% of 21 billion annually or proportional to active users) to avoid inflation or reward shortages. Bluetooth’s range limits direct transactions to nearby users (10-100 meters); mesh routing through other devices extends reach but may introduce latency in sparse networks. Encryption and blockchain syncing must be optimized to minimize Bluetooth bandwidth and power usage on mobile and Linux devices. Purpose field limited to short text (e.g., 50 characters) to minimize storage and bandwidth on mesh networks; encryption adds slight processing overhead, requiring optimization. Bluetooth support varies across Linux hardware/distributions, requiring testing to ensure reliable mesh networking. Linux’s smaller user base may limit adoption compared to mobile, so prioritize mobile-first with Linux as a secondary platform.

#### 8. Glossary of Terms
- **Mesh Networking**: Device-to-device communication forming a network without central infrastructure.
- **Blockchain**: Distributed ledger for secure, tamper-proof transaction records.
- **Closed Loop**: System where the currency (Scratch) circulates internally, like a gift card ecosystem.
- **BTC Savings Pot**: A feature to purchase and hold Bitcoin as a separate, appreciating asset.
- **API**: Application Programming Interface – a way for software to talk to other services.
